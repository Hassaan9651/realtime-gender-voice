<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        let socket = io.connect("http://localhost:5000");

        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(function(stream) {
                let audioContext = new AudioContext();
                let mediaStreamSource = audioContext.createMediaStreamSource(stream);
                let processor = audioContext.createScriptProcessor(4096, 1, 1);

                mediaStreamSource.connect(processor);
                processor.connect(audioContext.destination);

                processor.onaudioprocess = function(event) {
                    let audioData = event.inputBuffer.getChannelData(0);
                    let int16Array = new Int16Array(audioData.length);

                    for (let i = 0; i < audioData.length; i++) {
                        int16Array[i] = audioData[i] * 32767;
                    }

                    socket.emit("audio", int16Array.buffer);
                };
            })
            .catch(function(error) {
                console.error("Microphone access denied!", error);
            });

        socket.on("analysis", function(data) {
            document.getElementById("result").innerText = "Analysis: " + data;
        });
    </script>
</head>
<body>
    <h2>Live Audio Analysis</h2>
    <p id="result">Waiting for audio analysis...</p>
</body>
</html>
